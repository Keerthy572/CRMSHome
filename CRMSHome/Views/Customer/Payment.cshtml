@model CRMSHome.Models.PaymentViewModel

@{
    Layout = "_CustomerLayout";
   
    ViewData["Title"] = "Payment";
}
<link rel="stylesheet" href="~/css/payment.css" />

<div class="d-flex justify-content-center align-items-center" style="min-height: 100vh; background-color:#f8f9fa;">
    <div class="card shadow p-4" style="max-width: 400px; width: 100%; border-radius:12px;">

        <h4 class="text-center fw-bold mb-1">Payment Details</h4>
        <p class="text-center text-muted" style="font-size:14px;">
            Booking ID: <strong>@Model.BookingId</strong>
        </p>

        <form asp-action="PayNow" method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" asp-for="BookingId" />
            <input type="hidden" asp-for="Amount" />

            <div class="mb-3">
                <label asp-for="CardHolder" class="form-label"></label>
                <input asp-for="CardHolder" class="form-control" placeholder="John Doe" />
                <span asp-validation-for="CardHolder" class="text-danger"></span>
            </div>
            <div class="mb-3">
                <label asp-for="CardNumber" class="form-label"></label>
                <input asp-for="CardNumber" class="form-control" id="cardNumber" maxlength="19" placeholder="1234 5678 9012 3456" />
                <span asp-validation-for="CardNumber" class="text-danger"></span>
            </div>


            <div class="row g-2 mb-3">
                <div class="col-6">
                    <label asp-for="ExpiryDate" class="form-label"></label>
                    @* <input asp-for="ExpiryDate" class="form-control" maxlength="5" placeholder="MM/YY" /> *@
                    <input asp-for="ExpiryDate"
                           class="form-control"
                           maxlength="5"
                           id="ExpiryDate"
                           placeholder="MM/YY" />
                    <span asp-validation-for="ExpiryDate" class="text-danger"></span>

                    <span asp-validation-for="ExpiryDate" class="text-danger"></span>
                </div>
                <div class="col-6">
                    <label asp-for="CVV" class="form-label"></label>
                    <input asp-for="CVV" class="form-control" maxlength="4" placeholder="123" />
                    <span asp-validation-for="CVV" class="text-danger"></span>
                </div>
            </div>

            <div class="mb-3 d-flex justify-content-between align-items-center">
                <span class="fw-bold">Total Amount</span>
                <span class="fw-bold text-primary">Rs. @Model.Amount</span>
            </div>

            <div class="d-flex justify-content-between">
                <button type="submit" class="btn btn-primary">Pay Now</button>
                <a class="btn btn-outline-secondary" href="@Url.Action("CustomerDashboard", "Customer")">Cancel</a>
            </div>
        </form>
    </div>
</div>

@* @section Scripts {
    <partial name="_ValidationScriptsPartial" />
} *@
@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        const cardInput = document.getElementById("cardNumber");

        cardInput.addEventListener("input", function (e) {
            let value = e.target.value.replace(/\D/g, ""); // remove non-digits
            value = value.substring(0, 16); // max 16 digits

            // Add space every 4 digits
            let formatted = value.replace(/(.{4})/g, "$1 ").trim();

            e.target.value = formatted;
        });


                document.addEventListener("DOMContentLoaded", function () {
            const expiryInput = document.getElementById("ExpiryDate");

            expiryInput.addEventListener("input", function () {
                let value = expiryInput.value.replace(/[^0-9]/g, ""); // allow only numbers

                if (value.length > 4) value = value.substring(0, 4);

                if (value.length >= 3) {
                    let month = parseInt(value.substring(0, 2));
                    if (month > 12) month = 12; // max month 12

                    let year = value.substring(2);
                    value = (month < 10 ? "0" + month : month) + "/" + year;
                }

                expiryInput.value = value;
            });
        });
    </script>
}
